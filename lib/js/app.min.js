!function(){"use strict";angular.module("fhir-editor",["ui.router","LocalStorageModule"]).config(function(a,b,c){b.otherwise("/"),a.state("home",{url:"/",templateUrl:"./src/views/home.html",controller:"homeCtrl as home"}).state("home.base",{url:"base",templateUrl:"./src/views/base.html",controller:"baseCtrl as base"}).state("home.affiliations",{url:"affiliations",templateUrl:"./src/views/affiliations.html",controller:"affiliationsCtrl as affiliations"}).state("home.addresses",{url:"addresses",templateUrl:"./src/views/addresses.html",controller:"addressesCtrl as addresses"}).state("home.specialties",{url:"specialties",templateUrl:"./src/views/specialties.html",controller:"specialtiesCtrl as specialties"}).state("home.taxonomies",{url:"taxonomies",templateUrl:"./src/views/taxonomies.html",controller:"taxonomiesCtrl as taxonomies"}).state("home.licenses",{url:"licenses",templateUrl:"./src/views/licenses.html",controller:"licensesCtrl as licenses"}).state("home.notes",{url:"notes",templateUrl:"./src/views/notes.html",controller:"notesCtrl as notes"}).state("home.submit",{url:"submit",templateUrl:"./src/views/submit.html",controller:"submitCtrl as submit"})})}(),angular.module("fhir-editor").constant("APP_CONFIG",{apiKey:"AIzaSyCX68Oqtu9WT5nJZAgoeasHJk91-3CmLCU",clientId:"482782208078-sqeem22p4objiuvviagvf6tios32l42a.apps.googleusercontent.com",nppesSearchUrl:"http://api.docdish.com/search/api/public/nppes/pjson/pjson.json",pecosSearchUrl:"http://api.docdish.com/search/api/public/pecos/compiled/compiled.json",nppesUpdateUrl:"http://api.docdish.com/write/api/ip/nppes-update",pecosUpdateUrl:"http://api.docdish.com/write/api/ip/pecos-update",fhirUpdatePractitionerUrl:"http://api.docdish.com/write/api/ip/update-Provider"}),angular.module("fhir-editor").factory("PractitionerFHIR",function(){function a(a){var b=this;this.id=a.id,this.resourceType="Practitioner",this.identifier=[{system:"http://hl7.org/fhir/sid/us-npi",value:a.number}],this.active="A"===a.basic.status,this.name=[{family:a.basic.last_name,given:[a.basic.first_name]}],this.gender=null,"M"===a.basic.gender?b.gender="male":"F"===a.basic.gender?b.gender="female":b.gender="unknown",a.addresses&&(this.address=[],a.addresses.forEach(function(a){var c={use:a.address_purpose,line:[a.address_1,a.address_2],city:a.city,state:a.state,postalCode:a.zip};b.address.push(c)})),a.reassignments&&(this.role=[],a.reassignments.forEach(function(a){var c={identifier:[{system:"http://hl7.org/fhir/sid/us-npi",value:a.reassigned_to.npi}]};a.endpoints&&(c.endpoint=[],a.endpoints.forEach(function(a){var b={};"Direct Email"===a.type?(b.name="Direct Email",b.contact={system:"email",value:a.value}):"Regular Email"===a.type?(b.name="Regular Email",b.contact={system:"email",value:a.value}):"Web"===a.type&&(b.name="Web",b.contact={system:"url",value:a.value}),c.endpoint.push(b)})),b.role.push(c)}))}return a}),angular.module("fhir-editor").service("NPIService",function(a,b){function c(a){return $.ajax({method:"GET",url:b.nppesSearchUrl,data:{number:a},success:function(a){return a},error:function(a){return a}})}function d(a){return $.ajax({method:"GET",url:b.pecosSearchUrl,data:{npi:a},success:function(a){return a},error:function(a){return a}})}function e(a,c,d){var e={};return e["basic.first_name"]=a?a:void 0,e["basic.last_name"]=c?c:void 0,e["addresses.state"]=d?d:void 0,$.ajax({method:"GET",url:b.nppesSearchUrl,data:e,success:function(a){return a},error:function(a){return a}})}function f(a){return $.ajax({method:"GET",url:b.nppesSearchUrl,data:{title:a},success:function(a){return a},error:function(a){return a}})}function g(a){return $.ajax({method:"PUT",url:b.nppesUpdateUrl,data:JSON.stringify(a),success:function(a){return a},error:function(a){return a}})}function h(a){return $.ajax({method:"PUT",url:b.pecosUpdateUrl,data:JSON.stringify(a),success:function(a){return a},error:function(a){return a}})}function i(c){var d=new a(c);return console.log(d),$.ajax({method:"PUT",url:b.fhirUpdatePractitionerUrl,data:JSON.stringify(d),success:function(a){return a},error:function(a){return a}})}return{getNPPESByNpi:c,getPECOSByNpi:d,getNPPESByName:e,getNPPESByOrg:f,updateNPPES:g,updatePECOS:h,updatePractitionerFHIR:i}}),angular.module("fhir-editor").service("UserService",function(a){function b(){gapi.client.setApiKey(j),gapi.auth2.init({client_id:k,scope:"profile"}).then(function(){g=gapi.auth2.getAuthInstance(),g.isSignedIn.listen(c),c(g.isSignedIn.get())})}function c(a){a?(i=!0,h=!0):(i=!1,h=!0)}function d(){return g.signIn({prompt:"login"}),new Promise(function(a,b){var c=setInterval(function(){i&&(a(i),clearInterval(c))},20)})}function e(){return g.signOut(),new Promise(function(a,b){var c=setInterval(function(){i||(a(i),clearInterval(c))},20)})}function f(){return new Promise(function(a,b){var c=setInterval(function(){h&&(a(i),clearInterval(c))},20)})}var g,h=!1,i=!1,j=a.apiKey,k=a.clientId;return gapi.load("client:auth2",b),{signIn:d,signOut:e,checkSignIn:f}}),angular.module("fhir-editor").controller("addressesCtrl",function(a,b){}),angular.module("fhir-editor").controller("affiliationsCtrl",function(a,b,c){this.endpointTypes=["Direct Email","Regular Email","Web"],this.affiliationTypes=["Medicare"],this.addEndpoint=function(a){a.endpoints||(a.endpoints=[]),console.log(a.newEndpoint),a.endpoints.push(angular.copy(a.newEndpoint))},this.searchNewNpi=function(){}}),angular.module("fhir-editor").controller("baseCtrl",function(a,b){});var app=angular.module("fhir-editor");app.controller("homeCtrl",function(a,b,c,d,e,f){var g=this;this.signedIn=!1,e.checkSignIn().then(function(a){g.signedIn=a,b.$apply()}),this.signIn=function(){e.signIn().then(function(a,c){g.signedIn=a,console.log(c),b.$apply()})},this.signOut=function(){e.signOut().then(function(a){g.signedIn=a,b.$apply()})},this.resultFound=!1,this.summaryList=!1,this.npi=null,this.firstName=null,this.lastName=null,this.orgName=null,this.submitButton=null,this.reminderPopup=null,this.state="",this.dataloading=!1,this.result={id:null,title:null,number:null,basic:null,identifiers:null,addresses:null,taxonomies:null,taxonomy_licenses:null,licenses:null,pecos_id:null,enrollment_id:null,enrollment_type:null,reassignments:null,specialties:null,type:null},this.editing=null,this.nameSearchResult=null,this.nppesResult=null,this.pecosResult=null,this.fhirResult=null,this.runSearch=function(){this.preSearchClear(),g.dataloading=!0,g.npi?d.getNPPESByNpi(g.npi).done(function(c){if(200===c.code)if(c.results.length>0){console.log("NPPES Result:",c.results[0]),g.nppesResult=angular.copy(c.results[0]);var e=c.results[0];"NPI-2"===e.enumeration_type?(g.result.type="Organization",g.result.addresses=e.addresses||[],g.result.basic=e.basic||[],g.result.id=e.id||null,g.result.number=e.number||"N/A",g.result.taxonomies=e.taxonomies||[],g.result.taxonomy_groups=e.taxonomy_groups||[],g.result.title=e.title||"N/A"):"NPI-1"===e.enumeration_type&&(g.result.type="Individual",g.result.id=e.id||null,g.result.title=e.title||"N/A",g.result.number=e.number||"N/A",g.result.basic=e.basic||[],g.result.identifiers=e.identifiers||[],g.result.addresses=e.addresses||[],g.result.taxonomies=e.taxonomies||[],g.result.taxonomy_licenses=e.taxonomy_licenses||[],g.result.licenses=e.licenses||[]),d.getPECOSByNpi(g.npi).done(function(c){if(200===c.code){if(c.results.length>0){console.log("PECOS Result:",c.results[0]),g.pecosResult=angular.copy(c.results[0]);var d=c.results[0];g.result.pecos_id=d.pecos_id||"N/A",g.result.enrollment_id=d.enrollment_id||"N/A",g.result.enrollment_type=d.enrollment_type||"N/A",g.result.reassignments=d.reassignments||[],g.result.reassignments.forEach(function(a){a.acceptingNew||(a.acceptingNew="Yes")}),g.result.specialties=d.specialties||[]}else console.log("No PECOS search result");g.dataloading=!1,g.resultFound=!0,g.hideAbout=!0,g.npi=null,a.go("home.base"),b.$apply()}else console.log("There was a problem during the PECOS search")})}else console.log("There were no results");else console.log("There was a problem during the NPPES search")}):console.log("Nothing to search!"),setTimeout(function(){g.dataloading=!1,b.$apply()},4e3)},this.nameSearch=function(){g.dataloading=!0,this.resultFound=null;var c=g.firstName?g.firstName.toUpperCase():null,e=g.lastName?g.lastName.toUpperCase():null,f=g.state?g.state:null;d.getNPPESByName(c,e,f).done(function(c){200===c.code?c.results.length>0&&(g.dataloading=!1,g.summaryList=!0,g.hideAbout=!0,g.currentPage=0,console.log("NPPES Result:",c.results),g.nameSearchResult=c.results,g.pageNum=g.nameSearchResult.length,a.go("home.base"),b.$apply(),console.log()):console.log("No NPPES name search result")}),setTimeout(function(){g.dataloading=!1,b.$apply()},4e3)},this.orgSearch=function(){var c=g.orgName.toUpperCase();g.dataloading=!0,g.dataloading=!0,d.getNPPESByOrg(c).done(function(c){200===c.code?c.results.length>0&&(g.dataloading=!1,g.summaryList=!0,g.hideAbout=!0,g.currentPage=0,console.log("NPPES Result:",c.results),g.nameSearchResult=c.results,a.go("home.base"),b.$apply()):console.log("No NPPES name search result")}),setTimeout(function(){g.dataloading=!1,b.$apply()},4e3)},this.currentPage=0,this.pageSize=20,this.hideAbout=null,this.pageNum=null,this.numberOfPages=function(){return Math.ceil(g.pageNum/g.pageSize)},this.nameToNpi=function(a){g.summaryList=!1,g.npi=a,g.runSearch()},this.selected={},this.selected="item1",this.select=function(a){g.selected=a},this.isActive=function(a){return this.selected},this.searchItems=[{id:"item1",title:"NPI"},{id:"item2",title:"Name"},{id:"item3",title:"Organization"}],this.submitActive=function(){g.editing=null,g.submitButton=!0,this.reminder()},this.reminder=function(){g.reminderPopup=!0,setTimeout(function(){g.reminderPopup=null,b.$apply()},2e3)},this.mobileNav=function(){var a=document.getElementById("navId");"leftNav"===a.className?a.className+=" navShow":a.className="leftNav"},window.onbeforeunload=function(){this.resultFound=!1,this.summaryList=!1,this.npi=null,this.firstName=null,this.lastname=null,a.go("home")},this.preSearchClear=function(){this.result={id:null,title:null,number:null,basic:null,identifiers:null,addresses:null,taxonomies:null,taxonomy_licenses:null,licenses:null,pecos_id:null,enrollment_id:null,enrollment_type:null,reassignments:null,specialties:null},this.editing=null,this.submitButton=null,this.nameSearchResult=null,this.nppesResult=null,this.pecosResult=null,this.fhirResult=null}}),app.filter("startFrom",function(){return function(a,b){if(b=+b,a)return a.slice(b)}}),angular.module("fhir-editor").controller("licensesCtrl",function(a,b){}),angular.module("fhir-editor").controller("notesCtrl",function(a,b){}),angular.module("fhir-editor").controller("specialtiesCtrl",function(a,b){}),angular.module("fhir-editor").controller("submitCtrl",function(a,b,c,d){this.submitEdits=function(){var a=d.home.result,c=angular.copy(a);d.home.submitButton=null;var e=d.home.nppesResult,f=d.home.pecosResult,g=angular.copy(e),h=angular.copy(f);console.log("Test NPPES Update Info:",g),console.log("Test PECOS Update Info:",g),console.log("Test FHIR Update Info:",c),b.updateNPPES(g).done(function(a){console.log("NPPES Update Response",a)}),b.updatePECOS(h).done(function(a){console.log("PECOS Update Response",a)}),b.updatePractitionerFHIR(c).done(function(a){console.log("FHIR Update Response",a)}),$(".submitEditsBtn").css({background:"lightgreen",color:"white"}).text("Submitted!"),setTimeout(function(){$(".submitEditsBtn").css({background:"buttonface",color:"buttontext"}).text("Submit Edits")},1e3)}}),angular.module("fhir-editor").controller("taxonomiesCtrl",function(a,b){});